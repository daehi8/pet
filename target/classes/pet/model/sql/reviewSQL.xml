<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="review">
	<insert id="insertReview" parameterType="reviewDTO">
		insert into review(
			no,
			member_email,
			hospital_name,
			doc_name,
			revisit,
			public_check,
			reg_date
		)values(
			review_seq.nextval,
			#{member_email},
			#{hospital_name},
			#{doc_name},
			#{revisit},
			#{public_check},
			sysdate
		)	
	</insert>
	
	<select id="selectNewNo" resultType="int">
		select max(no) from review
	</select>
	
	<select id="getListReview" parameterType="hashMap" resultType="reviewDTO">
		select no,member_email,hospital_name,doc_name,revisit,public_check,auth_check,reg_date,r from 
		(select no,member_email,hospital_name,doc_name,revisit,public_check,auth_check,reg_date,rownum r from 
		(select * from review order by reg_date desc) where hospital_name = #{hospital_name} and auth_check = 'N' and public_check = 'Y')
		<![CDATA[where r >= #{start} and r <= #{end}]]>
	</select>
	
	<select id="getListReviewCount" resultType="int">
		select count(*) from review where hospital_name = #{hospital_name} and auth_check = 'N' and public_check = 'Y'
	</select>
	
	<select id="getRecomCount" parameterType="String" resultType="int">
		select count(revisit) from review where revisit = 'Y' and hospital_name = #{value}
	</select>
	
	<select id="getNotRecomCount" parameterType="String" resultType="int">
		select count(revisit) from review where revisit = 'N' and hospital_name = #{value}
	</select>
</mapper>
